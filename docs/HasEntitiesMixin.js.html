<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: HasEntitiesMixin.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: HasEntitiesMixin.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const _ = require('underscore')
const Mixin = require('./Mixin')

/**
 * The DOM CanvasRenderingContext2D interface.
 * @typedef CanvasRenderingContext2D Object
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D}
 */

/**
 * HasEntitiesMixin is a {@link Mixin} to add a collection of {@link Entity}s to a class
 * @hideconstructor
 */
class HasEntitiesMixin extends Mixin {
	static init(obj, options = {}) {
		obj._entities = {}
		obj._entityOrder = null
		obj._entityOrderMap = null
	}

	/**
	* Add a entity to this container with the given name.
	* @param {String} name The name to assign to the entity
	* @param {Entity} entity The Entity to add
	*/
	addEntity(name, entity) {
		this._entities[name] = entity
		entity.name = name
		if(entity.parent &amp;&amp; entity.parent.removeEntity) entity.parent.removeEntity(name)
		entity.parent = this
		return entity
	}

	/**
	* Remove a named entity from this container, will trigger a redraw if defined on the container class
	* @param {String} name The name of the entity to remove
	*/
	removeEntity(name) {
		delete this._entities[name]
		if(this.redraw) this.redraw()
	}

	/**
	* Return the entity with the given name. Throws an exception if the entity is not found.
	* @param {String} name The name of the entity to return
	* @returns {Entity} The Entity with the given name if found
	* @throws {Exception} 'Entity not found' if the entity is not found
	*/
	getEntity(name) {
		if (!this._entities[name]) throw 'Entity not found: '+name
		return this._entities[name]
	}

	/** 
	* Draw entities in z-order
	* @param {CanvasRenderingContext2D} context The context in which to draw
	* @param {integer} z If specified, only draw entities with this z-layer (mapped by [sortEntitiesZ()]{@link HasEntities#sortEntitiesZ})
	*/
	drawEntities(context, z = null) {
		if(!this._entityOrder) this.sortEntitiesZ()
		if(z === null) {
			for(var i in this._entityOrder) this._entityOrder[i].draw(context)
		} else {
			for(var i in this._entityOrderMap[z]) this._entityOrderMap[z][i].draw(context)
		}
	}

	/**
	* Get entities from a particular layer
	* @param {integer} z Entity z-order to get (mapped by [sortEntitiesZ()]{@link HasEntities#sortEntitiesZ})
	*/
	getEntitiesAtLayer(z) {
		if(!this._entityOrder) this.sortEntitiesZ()
		return this._entityOrderMap[z] || []
	}	

	/**
	* Recalculate the draw order of all entities based on their Z coordinate and store internally, for use by [drawEntities()]{@link HasEntities#drawEntities}) and [getEntitiesAtLayer()]{@link HasEntities#getEntitiesAtLayer})
	*/
	sortEntitiesZ() {
		this._entityOrder = _.sortBy(Object.values(this._entities), 'z')
		var last = 0
		this._entityOrderMap = {}
		for(var i in this._entityOrder) {
			var entity = this._entityOrder[i]
			this._entityOrderMap[entity.z] = this._entityOrderMap[entity.z] || []
			this._entityOrderMap[entity.z].push(entity)
		}
	}

	/**
	* Call redraw on all entities in this container by calling [redraw()]{@link Entity#redraw}
	*/
	redrawEntities() {
		for(var i in this._entities) this._entities[i].redraw()
	}
}

module.exports = Mixin.export(HasEntitiesMixin)</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Asset.html">Asset</a></li><li><a href="Audio.html">Audio</a></li><li><a href="BackgroundScene.html">BackgroundScene</a></li><li><a href="Entity.html">Entity</a></li><li><a href="GameEngine.html">GameEngine</a></li><li><a href="HasEntitiesMixin.html">HasEntitiesMixin</a></li><li><a href="HasEventsMixin.html">HasEventsMixin</a></li><li><a href="HasScenesMixin.html">HasScenesMixin</a></li><li><a href="Logger.html">Logger</a></li><li><a href="Mixin.html">Mixin</a></li><li><a href="Scene.html">Scene</a></li><li><a href="TiledScene.html">TiledScene</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
