<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: HasScenesMixin.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: HasScenesMixin.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const _ = require('underscore')
const Mixin = require('./Mixin')

/**
 * The DOM CanvasRenderingContext2D interface.
 * @typedef CanvasRenderingContext2D Object
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D}
 */

/**
 * HasScenesMixin is a {@link Mixin} to add a collection of {@link Scene}s to a class
 * @hideconstructor
 */
class HasScenesMixin extends Mixin {
	static init(obj, options = {}) {
		obj._scenes = {}
		obj._sceneOrder = null
		obj._sceneOrderMap = null
	}

	/**
	* Add a scene to this container with the given name.
	* @param {String} name The name to assign to the scene
	* @param {Scene} scene The Scene to add
	*/
	addScene(name, scene) {
		this._scenes[name] = scene
		scene.name = name
		if(scene.parent &amp;&amp; scene.parent.removeScene) scene.parent.removeScene(name)
		scene.parent = this
		return scene
	}

	/**
	* Remove a named scene from this container, will trigger a redraw if defined on the container class
	* @param {String} name The name of the scene to remove
	*/
	removeScene(name) {
		delete this._scenes[name]
		if(this.redraw) this.redraw()
	}

	/**
	* Return the scene with the given name. Throws an exception if the scene is not found.
	* @param {String} name The name of the scene to return
	* @returns {Scene} The Scene with the given name if found
	* @throws {Exception} 'Scene not found' if the scene is not found
	*/
	getScene(name) {
		if (!this._scenes[name]) throw 'Scene not found: '+name
		return this._scenes[name]
	}

	/** 
	* Draw scenes in z-order
	* @param {CanvasRenderingContext2D} context The context in which to draw
	* @param {integer} z If specified, only draw scenes with this z-layer (mapped by [sortScenesZ()]{@link HasScenes#sortScenesZ})
	*/
	drawScenes(context, z = null) {
		if(!this._sceneOrder) this.sortScenesZ()
		if(z === null) {
			for(var i in this._sceneOrder) this._sceneOrder[i].draw(context)
		} else {
			for(var i in this._sceneOrderMap[z]) this._sceneOrderMap[z][i].draw(context)
		}
	}

	/**
	* Get scenes from a particular layer
	* @param {integer} z Scene z-order to get (mapped by [sortScenesZ()]{@link HasScenes#sortScenesZ})
	*/
	getScenesAtLayer(z) {
		if(!this._sceneOrder) this.sortScenesZ()
		return this._sceneOrderMap[z] || []
	}	

	/**
	* Recalculate the draw order of all scenes based on their Z coordinate and store internally, for use by [drawScenes()]{@link HasScenes#drawScenes}) and [getScenesAtLayer()]{@link HasScenes#getScenesAtLayer})
	*/
	sortScenesZ() {
		this._sceneOrder = _.sortBy(Object.values(this._scenes), 'z')
		var last = 0
		this._sceneOrderMap = {}
		for(var i in this._sceneOrder) {
			var scene = this._sceneOrder[i]
			this._sceneOrderMap[scene.z] = this._sceneOrderMap[scene.z] || []
			this._sceneOrderMap[scene.z].push(scene)
		}
	}

	/**
	* Call redraw on all scenes in this container by calling [redraw()]{@link Scene#redraw}
	*/
	redrawScenes() {
		for(var i in this._scenes) this._scenes[i].redraw()
	}
}

module.exports = Mixin.export(HasScenesMixin)</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Asset.html">Asset</a></li><li><a href="Audio.html">Audio</a></li><li><a href="BackgroundScene.html">BackgroundScene</a></li><li><a href="Entity.html">Entity</a></li><li><a href="GameEngine.html">GameEngine</a></li><li><a href="HasEntitiesMixin.html">HasEntitiesMixin</a></li><li><a href="HasEventsMixin.html">HasEventsMixin</a></li><li><a href="HasScenesMixin.html">HasScenesMixin</a></li><li><a href="Logger.html">Logger</a></li><li><a href="Mixin.html">Mixin</a></li><li><a href="Scene.html">Scene</a></li><li><a href="TiledScene.html">TiledScene</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
